[tools]
node = "latest"
pnpm = "latest"

[tasks.ok]
description = "Run format, typecheck, tests, and knip checks"
run = "bun run ok"

[tasks."web:dev"]
run = "bun --cwd packages/web dev"

[tasks."sandbox:polar-sync"]
description = "Sync Polar.sh configuration (sandbox)"
run = "mise -E sandbox exec -- bun run scripts:run -- polar-sync --server sandbox --recreate"

[tasks."production:polar-sync"]
description = "Sync Polar.sh configuration (production)"
run = "mise -E production exec -- bun run scripts:run -- polar-sync"

[tasks."db:migrate"]
description = "Run database migrations"
run = "bun --cwd packages/web drizzle-kit migrate"

[tasks."db:generate-migration"]
description = "Generate a new migration"
run = "bun --cwd packages/web drizzle-kit generate"

[tasks."clear-test-user"]
description = "Clear test user from Turso and Polar"
run = "bun -C packages/web scripts/clear-test-user.ts {{arg(name='email')}}"

[tasks."delete-user:dry-run"]
description = "Dry-run account deletion workflow by email"
run = "bun scripts/delete-user.ts --email {{arg(name='email')}} --dry-run"

[tasks."delete-user:execute"]
description = "Execute account deletion workflow by email"
run = "bun scripts/delete-user.ts --email {{arg(name='email')}} --execute --confirm {{arg(name='confirm')}}"

[tasks.format]
description = "Run biome check on jj working copy changed files"
run = '''
jj diff --summary | awk '$1 != "D" {print $2}' | grep -E '\.(ts|tsx|js|jsx|json|css)$' | xargs bunx biome check --write
'''
