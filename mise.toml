[tools]
node = "latest"
bun = "latest"

[tasks.ok]
description = "Run format, typecheck, and knip checks"
run = [
  { task = "format" },
  { tasks = ["typecheck:cli", "typecheck:web"] },
  { task = "knip" },
]

[tasks.format]
description = "Format code with Biome"
run = "bun run --silent format"

[tasks.knip]
description = "Check for unused exports and dependencies"
run = "bun run --silent knip"

[tasks."typecheck:cli"]
description = "Typecheck packages/cli"
run = "bun run --silent --cwd packages/cli typecheck"

[tasks."typecheck:web"]
description = "Typecheck packages/web"
run = "bun run --silent --cwd packages/web typecheck"

[tasks."dev:web"]
description = "Start web dev server"
run = "bun run --cwd packages/web next dev --port ${PORT:-3000}"

[tasks.web]
description = "Start web dev server (sandbox env)"
run = "mise -E sandbox run dev:web"

[tasks."dev:translate"]
description = "translate "
run = "bun run scripts/translate.ts"

[tasks.translate]
description = "Run translate "
run = "mise -E sandbox run dev:translate"

[tasks."script:polar-sync"]
description = "Sync Polar.sh configuration (meters, benefits, products)"
run = "bun run --cwd scripts polar-sync.ts {{arg(name='flags', var=true)}}"

[tasks."sandbox:polar-sync"]
description = "Sync Polar.sh configuration (sandbox)"
run = "mise -E sandbox run script:polar-sync {{arg(name='flags', var=true)}}"

[tasks."production:polar-sync"]
description = "Sync Polar.sh configuration (production)"
run = "mise -E production run script:polar-sync --production {{arg(name='flags', var=true)}}"
