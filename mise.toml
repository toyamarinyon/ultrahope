[tools]
node = "latest"
pnpm = "latest"

[tasks.ok]
description = "Run format, typecheck, and knip checks"
run = [
  { task = "format" },
  { tasks = ["typecheck:cli", "typecheck:web"] },
  { task = "knip" },
]

[tasks.format]
description = "Format code with Biome"
run = "pnpm -w --silent run format"

[tasks.knip]
description = "Check for unused exports and dependencies"
run = "pnpm -w --silent run knip"

[tasks."typecheck:cli"]
description = "Typecheck packages/cli"
run = "pnpm -C packages/cli --silent run typecheck"

[tasks."typecheck:web"]
description = "Typecheck packages/web"
run = "pnpm -C packages/web --silent run typecheck"

[tasks."dev:web"]
description = "Start web dev server"
run = "pnpm -C packages/web run dev --port ${PORT:-3000}"

[tasks.web]
description = "Start web dev server (sandbox env)"
run = "mise -E sandbox run dev:web"

[tasks."dev:translate"]
description = "translate "
run = "pnpm -w exec tsx scripts/translate.ts"

[tasks.translate]
description = "Run translate "
run = "mise -E sandbox run dev:translate"

[tasks."script:polar-sync"]
description = "Sync Polar.sh configuration (meters, benefits, products)"
run = "pnpm -w exec tsx scripts/polar-sync.ts {{option(name='flags', var=true)}}"

[tasks."sandbox:polar-sync"]
description = "Sync Polar.sh configuration (sandbox)"
run = "mise -E sandbox run script:polar-sync {{option(name='flags', var=true)}}"

[tasks."production:polar-sync"]
description = "Sync Polar.sh configuration (production)"
run = "pnpm -w exec tsx scripts/polar-sync.ts --production"
